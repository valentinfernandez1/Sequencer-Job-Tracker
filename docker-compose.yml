version: "3.9"

services:
    keeper:
        build: .
        container_name: keeper-network-monitor
        restart: unless-stopped
        env_file:
            - .env
        ports:
            - "9100:9100" # optional, useful for local debugging (metrics)
        healthcheck:
            test: ["CMD-SHELL", "curl -fsS http://localhost:9100/metrics || exit 1"]
            interval: 30s
            timeout: 5s
            retries: 3
            start_period: 10s
        networks:
            - monitoring
    prometheus:
        image: prom/prometheus:latest
        container_name: prometheus
        restart: unless-stopped
        volumes:
            - ./prometheus/prometheus.yml:/etc/prometheus/prometheus.yml:ro
        command:
            - "--config.file=/etc/prometheus/prometheus.yml"
        ports:
            - "9090:9090"
        networks:
            - monitoring

networks:
    monitoring:
        driver: bridge
